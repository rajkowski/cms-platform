!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.supersetEmbeddedSdk=t():e.supersetEmbeddedSdk=t()}(globalThis,(function(){return(()=>{"use strict";var __webpack_modules__={98:(module,__webpack_exports__,__webpack_require__)=>{var enterModule;__webpack_require__.d(__webpack_exports__,{g:()=>Switchboard}),module=__webpack_require__.hmd(module),enterModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.enterModule:void 0,enterModule&&enterModule(module);var __signature__="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default.signature:function(e){return e},Actions,reactHotLoader,leaveModule;class Switchboard{constructor({port:e,name:t="switchboard",debug:r=!1}){this.port=void 0,this.name=void 0,this.methods={},this.incrementor=1,this.debugMode=void 0,this.port=e,this.name=t,this.debugMode=r,e.addEventListener("message",(async e=>{this.log("message received",e);const t=e.data;if(isGet(t))this.port.postMessage(await this.getMethodResult(t));else if(isEmit(t)){const{method:e,args:r}=t,o=this.methods[e];o&&o(r)}}))}async getMethodResult({messageId:e,method:t,args:r}){const o=this.methods[t];if(null==o)return{switchboardAction:Actions.ERROR,messageId:e,error:`[${this.name}] Method "${t}" is not defined`};try{const t=await o(r);return{switchboardAction:Actions.REPLY,messageId:e,result:t}}catch(r){return this.logError(r),{switchboardAction:Actions.ERROR,messageId:e,error:`[${this.name}] Method "${t}" threw an error`}}}defineMethod(e,t){this.methods[e]=t}get(e,t){return new Promise(((r,o)=>{const s=this.getNewMessageId(),a=e=>{const t=e.data;if(t.messageId===s)if(this.port.removeEventListener("message",a),isReply(t))r(t.result);else{const e=isError(t)?t.error:"Unexpected response message";o(new Error(e))}};this.port.addEventListener("message",a),this.port.start();const n={switchboardAction:Actions.GET,method:e,messageId:s,args:t};this.port.postMessage(n)}))}emit(e,t){const r={switchboardAction:Actions.EMIT,method:e,args:t};this.port.postMessage(r)}start(){this.port.start()}log(...e){this.debugMode&&console.debug(`[${this.name}]`,...e)}logError(...e){console.error(`[${this.name}]`,...e)}getNewMessageId(){return`m_${this.name}_${this.incrementor++}`}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}function isGet(e){return e.switchboardAction===Actions.GET}function isReply(e){return e.switchboardAction===Actions.REPLY}function isEmit(e){return e.switchboardAction===Actions.EMIT}function isError(e){return e.switchboardAction===Actions.ERROR}!function(e){e.GET="get",e.REPLY="reply",e.EMIT="emit",e.ERROR="error"}(Actions||(Actions={})),reactHotLoader="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.default:void 0,reactHotLoader&&(reactHotLoader.register(Switchboard,"Switchboard","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isGet,"isGet","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isReply,"isReply","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isEmit,"isEmit","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts"),reactHotLoader.register(isError,"isError","/Users/aaron/work/superset/superset-frontend/packages/superset-ui-switchboard/src/switchboard.ts")),leaveModule="undefined"!=typeof reactHotLoaderGlobal?reactHotLoaderGlobal.leaveModule:void 0,leaveModule&&leaveModule(module)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{embedDashboard:()=>r});var e=__webpack_require__(98);function t(e){const t=JSON.parse(Buffer.from(e.split(".")[1],"base64").toString()),r=new Date(/[^0-9\.]/g.test(t.exp)?t.exp:1e3*parseFloat(t.exp));return("Invalid Date"!==r.toString()?Math.max(1e4,r.getTime()-Date.now()):3e5)-5e3}async function r(r){let{id:o,supersetDomain:s,mountPoint:a,fetchGuestToken:n,dashboardUiConfig:i,debug:d=!1}=r;function c(){if(d){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.debug(`[superset-embedded-sdk][dashboard ${o}]`,...t)}}c("embedding");const[_,u]=await Promise.all([n(),async function(){return new Promise((t=>{const r=document.createElement("iframe"),n=i?`?uiConfig=${function(){let e=0;return i&&(i.hideTitle&&(e+=1),i.hideTab&&(e+=2),i.hideChartControls&&(e+=8)),e}()}`:"";r.sandbox.add("allow-same-origin"),r.sandbox.add("allow-scripts"),r.sandbox.add("allow-presentation"),r.sandbox.add("allow-downloads"),r.addEventListener("load",(()=>{const o=new MessageChannel,a=o.port1,n=o.port2;r.contentWindow.postMessage({type:"__embedded_comms__",handshake:"port transfer"},s,[n]),c("sent message channel to the iframe"),t(new e.g({port:a,name:"superset-embedded-sdk",debug:d}))})),r.src=`${s}/embedded/${o}${n}`,a.replaceChildren(r),c("placed the iframe")}))}()]);return u.emit("guestToken",{guestToken:_}),c("sent guest token"),setTimeout((async function e(){const r=await n();u.emit("guestToken",{guestToken:r}),setTimeout(e,t(r))}),t(_)),{getScrollSize:()=>u.get("getScrollSize"),unmount:function(){c("unmounting"),a.replaceChildren()}}}})(),__webpack_exports__})()}));
//# sourceMappingURL=index.js.map